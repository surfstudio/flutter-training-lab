# üíæ –õ–†5: –†–∞–±–æ—Ç–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

## üîÑ –≠–≤–æ–ª—é—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö –º—ã —Å–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç —Å —Å–µ—Ç–µ–≤—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º. 

---

### ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–°–µ–π—á–∞—Å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Å–µ—Ç–∏, –Ω–æ **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ**. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

> **üö® –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
> - üîÑ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
> - ‚ù§Ô∏è –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏  
> - üîç –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
> - ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
> - üì∂ –ù–µ—Ç —Ä–∞–±–æ—Ç—ã –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
> - üé® –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è

## üéØ –ß—Ç–æ –º—ã –±—É–¥–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å

–¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç** —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º:

### üìã –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

|| –≠—Ç–∞–ø | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----------|----------|
| 1Ô∏è‚É£ | **–ö–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** | SharedPreferences –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| 2Ô∏è‚É£ | **SQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | Drift –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| 3Ô∏è‚É£ | **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞** | Repository –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ |
| 4Ô∏è‚É£ | **DAO –ø–∞—Ç—Ç–µ—Ä–Ω** | Data Access Objects –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º |
| 5Ô∏è‚É£ | **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ UI** | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |

---

> üí° **–í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å:** –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ - —ç—Ç–æ **–æ—Å–Ω–æ–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞** –≤ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. –û—Ç –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏—Ç —É–¥–æ–±—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

üìñ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:**
- [Persistence –≤–æ Flutter](https://docs.flutter.dev/cookbook/persistence)
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Drift](https://pub.dev/packages/drift)

---

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏.

# üóÑÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤–æ Flutter

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## üèóÔ∏è –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â:

```
UI Layer (Widgets/Pages)
     ‚Üì
Business Logic Layer (Models)  
     ‚Üì
Repository Layer (StorageRepository)
     ‚Üì 
Storage Layer ‚Üí SharedPreferences (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
              ‚Üí Drift Database (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
              ‚Üí File System (–∫—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
```

### üéØ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è:

|| –°–ª–æ–π | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |
|------|------|-------------|---------------------|
| **üé® UI Layer** | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è | Widgets, Pages, Screens |
| **üß† Business Logic** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ | Models, Blocs, Controllers |
| **üì¶ Repository** | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö | Repository, Storage Interfaces |  
| **üíæ Storage Layer** | –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | SharedPreferences, Database, Files |

---

## üîß –¢–∏–ø—ã –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤–æ Flutter

–í–æ Flutter –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:

|| –†–µ—à–µ–Ω–∏–µ | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è |
|---------|-------------|-------------|-----------------|
| **[SharedPreferences](https://pub.dev/packages/shared_preferences)** | –ö–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ | ‚Ä¢ –ü—Ä–æ—Å—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏<br>‚Ä¢ –ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã<br>‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API | üéõÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |  
| **[Drift](https://pub.dev/packages/drift)** | SQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | ‚Ä¢ –†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ<br>‚Ä¢ –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã<br>‚Ä¢ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **[Hive](https://pub.dev/packages/hive)** | NoSQL –±–∞–∑–∞ | ‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–ø–∏—Å—å<br>‚Ä¢ –û–±—ä–µ–∫—Ç–Ω–∞—è –º–æ–¥–µ–ª—å<br>‚Ä¢ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ | ‚ö° –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| **[File System](https://pub.dev/packages/path_provider)** | –§–∞–π–ª—ã | ‚Ä¢ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è<br>‚Ä¢ –î–æ–∫—É–º–µ–Ω—Ç—ã<br>‚Ä¢ –ö—ç—à –¥–∞–Ω–Ω—ã—Ö | üìÅ –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã |

### üéØ –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ Drift + SharedPreferences?

–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥**:

<details>
<summary>‚úÖ <strong>SharedPreferences –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫</strong></summary>

- üéõÔ∏è **–ü—Ä–æ—Å—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —Ç–µ–º–∞, —è–∑—ã–∫, —Ñ–∏–ª—å—Ç—Ä—ã
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** –∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º –¥–∞–Ω–Ω—ã–º
- üîÑ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- üì± **–ù–∞—Ç–∏–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö

</details>

<details>
<summary>‚úÖ <strong>Drift –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</strong></summary>

- üóÉÔ∏è **–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏
- üõ°Ô∏è **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏  
- üîÑ **–ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã** –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
- üìä **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** —Å JOIN, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
- üéØ **Code generation** –¥–ª—è DAO –∏ —Ç–∞–±–ª–∏—Ü

</details>

---

# üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–≤–∞–π—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:

### üóÉÔ∏è AppDatabase - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ Drift ORM:

```dart
@DriftDatabase(
  tables: [
    FavoritePlacesTable,
    HistorySearchTable,
  ],
  daos: [
    FavoritesDao,
    HistorySearchDao,
  ],
)
class AppDatabase extends _$AppDatabase {
  AppDatabase() : super(_openConnection());

  @override
  int get schemaVersion => 1;
}
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã —á–µ—Ä–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏
- üîÑ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü –∏ DAO
- üìÅ SQLite —Ñ–∞–π–ª –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- üõ°Ô∏è –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏

### üìä –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### FavoritePlacesTable - –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
```dart
class FavoritePlacesTable extends Table {
  IntColumn get id => integer()();
  IntColumn get placeId => integer()();
  TextColumn get name => text()();
  TextColumn get description => text()();
  IntColumn get type => intEnum<PlaceType>()();
  TextColumn get images => text().map(const ListStringConverter())();
  RealColumn get lat => real()();
  RealColumn get lon => real()();
  
  @override
  Set<Column> get primaryKey => {id};
}
```

#### HistorySearchTable - –∏—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞
```dart
class HistorySearchTable extends Table {
  IntColumn get id => integer()();
  TextColumn get keyword => text()();
  
  @override
  Set<Column> get primaryKey => {id};
}
```

### üîß DAO - Data Access Objects

#### FavoritesDao - —Ä–∞–±–æ—Ç–∞ —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º–∏
```dart
@DriftAccessor(tables: [FavoritePlacesTable])
class FavoritesDao extends DatabaseAccessor<AppDatabase> with _$FavoritesDaoMixin {
  
  Stream<List<FavoritePlacesTableData>> get favoritesStream => 
    select(favoritePlacesTable).watch();

  Future<void> addFavorite(FavoritePlacesTableCompanion place) =>
    into(favoritePlacesTable).insert(place, mode: InsertMode.replace);

  Future<void> removeFavorite(int placeId) =>
    (delete(favoritePlacesTable)..where((tbl) => tbl.placeId.equals(placeId))).go();
}
```

### üéõÔ∏è SharedPreferences —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### FilterStorage - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
```dart
class FilterStorage implements IFilterStorage {
  final SharedPreferences _prefs;

  @override
  Future<FilterPlacesRequestDto> getFilter() async {
    final filter = _prefs.getString(FilterStorageKeys.filter.keyName);
    if (filter == null || filter.trim().isEmpty) return _defaultFilter;
    
    final decoded = jsonDecode(filter) as Map<String, dynamic>;
    return FilterPlacesRequestDto.fromJson(decoded);
  }

  @override
  Future<void> saveFilter({required FilterPlacesRequestDto filterDto}) async {
    await _prefs.setString(FilterStorageKeys.filter.keyName, jsonEncode(filterDto));
  }
}
```

#### ThemeModeStorage - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã
```dart
class ThemeModeStorage implements IThemeModeStorage {
  @override
  Future<ThemeMode> getThemeMode() async {
    final themeName = _prefs.getString(ThemeStorageKeys.mode.keyName);
    return ThemeMode.values.firstWhereOrNull((mode) => mode.name == themeName) ?? 
           _defaultThemeMode;
  }
}
```

---

# üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

## üóÉÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Drift Database

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```dart
LazyDatabase _openConnection() {
  return LazyDatabase(() async {
    final dbFolder = await getApplicationDocumentsDirectory();
    final file = File(p.join(dbFolder.path, 'db.sqlite'));

    return NativeDatabase.createInBackground(file);
  });
}
```

### üîë –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

|| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|------------|
| **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ** | `Documents Directory` | –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –ø–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **–ò–º—è —Ñ–∞–π–ª–∞** | `db.sqlite` | SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| **–†–µ–∂–∏–º** | `createInBackground` | –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ —Å–æ–∑–¥–∞–Ω–∏–µ |
| **–í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã** | `1` | –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –≤ –±—É–¥—É—â–µ–º |

---

## üìã –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ Drift

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤

```dart
class FavoritePlacesTable extends Table {
  // –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–Ω—ã–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
  IntColumn get id => integer()();
  
  // –°—Å—ã–ª–∫–∞ –Ω–∞ –º–µ—Å—Ç–æ –∏–∑ API
  IntColumn get placeId => integer()();
  
  // –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
  TextColumn get name => text()();
  TextColumn get description => text()();
  
  // Enum –∑–Ω–∞—á–µ–Ω–∏—è
  IntColumn get type => intEnum<PlaceType>()();
  
  // –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
  TextColumn get images => text().map(const ListStringConverter())();
  
  // –ß–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
  RealColumn get lat => real()();
  RealColumn get lon => real()();
  
  @override
  Set<Column> get primaryKey => {id};
}
```

### üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–æ—Ä—ã —Ç–∏–ø–æ–≤

```dart
class ListStringConverter extends TypeConverter<List<String>, String> {
  const ListStringConverter();

  @override
  List<String> fromSql(String fromDb) {
    return fromDb.split(',');
  }

  @override
  String toSql(List<String> value) {
    return value.join(',');
  }
}
```

|| –¢–∏–ø Dart | –¢–∏–ø SQL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|---------------------|
| **List<String>** | **TEXT** | –°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é |
| **PlaceType** | **INTEGER** | Enum –∫–∞–∫ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
| **DateTime** | **INTEGER** | Unix timestamp |

---

## üîß DAO - –ø–∞—Ç—Ç–µ—Ä–Ω –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ CRUD

```dart
@DriftAccessor(tables: [FavoritePlacesTable])
class FavoritesDao extends DatabaseAccessor<AppDatabase> with _$FavoritesDaoMixin {
  
  // CREATE - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
  Future<void> addFavorite(FavoritePlacesTableCompanion place) =>
    into(favoritePlacesTable).insert(place, mode: InsertMode.replace);
  
  // READ - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö  
  Future<List<FavoritePlacesTableData>> fetchFavorites() => 
    select(favoritePlacesTable).get();
  
  // READ - —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
  Stream<List<FavoritePlacesTableData>> get favoritesStream => 
    select(favoritePlacesTable).watch();
  
  // DELETE - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
  Future<void> removeFavorite(int placeId) =>
    (delete(favoritePlacesTable)..where((tbl) => tbl.placeId.equals(placeId))).go();
}
```

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ DAO –ø–∞—Ç—Ç–µ—Ä–Ω–∞:

|| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|----------|
| **–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è** | –°–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | –õ–µ–≥–∫–æ –º–æ–∫–∞—Ç—å –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤ |
| **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** | –û–¥–∏–Ω DAO –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–∞–±–ª–∏—Ü–µ–π |
| **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ |

---

## üíæ SharedPreferences –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Storage –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```dart
class FilterStorage implements IFilterStorage {
  static final _defaultFilter = FilterPlacesRequestDto.createDefault();
  final SharedPreferences _prefs;
  
  const FilterStorage(this._prefs);

  @override
  Future<FilterPlacesRequestDto> getFilter() async {
    final filter = _prefs.getString(FilterStorageKeys.filter.keyName);
    if (filter == null || filter.trim().isEmpty) return _defaultFilter;

    final decoded = jsonDecode(filter) as Map<String, dynamic>;
    return FilterPlacesRequestDto.fromJson(decoded);
  }

  @override
  Future<void> saveFilter({required FilterPlacesRequestDto filterDto}) async {
    await _prefs.setString(FilterStorageKeys.filter.keyName, jsonEncode(filterDto));
  }
}
```

### üîë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏

```dart
enum FilterStorageKeys {
  filter('filter_settings');

  final String keyName;
  const FilterStorageKeys(this.keyName);
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π:**
- üéØ –ò–∑–±–µ–∂–∞–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫ –≤ –∫–ª—é—á–∞—Ö
- üîÑ –õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
- üìä –û–±–∑–æ—Ä –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

---

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

```dart
abstract base class BaseStorageRepository {
  @protected
  Future<T> safeStorageCall<T>(Future<T> Function() call, T defaultValue) async {
    try {
      return await call();
    } on DatabaseException catch (e, s) {
      // –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
      _logger.error('Database error: ${e.message}', e, s);
      return defaultValue;
    } on FormatException catch (e, s) {
      // –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π JSON
      _logger.error('Serialization error: ${e.message}', e, s);
      return defaultValue;
    } on FileSystemException catch (e, s) {
      // –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
      _logger.error('File system error: ${e.message}', e, s);
      return defaultValue;
    } on Object catch (e, s) {
      // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
      _logger.error('Unknown storage error: $e', e, s);
      return defaultValue;
    }
  }
}
```

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –ø—Ä–æ–±–ª–µ–º:

| –¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã | –ü—Ä–∏—á–∏–Ω–∞ | –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ |
|-------------|----------|----------|
| **DatabaseException** | –ö–æ—Ä—Ä—É–ø—Ü–∏—è –±–∞–∑—ã, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | –í–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **FormatException** | –ù–µ–≤–µ—Ä–Ω—ã–π JSON, —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ | –û—á–∏—Å—Ç–∫–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö |
| **FileSystemException** | –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞, –¥–∏—Å–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

# üé® –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI —Å–ª–æ–µ–º

–ü–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–ø - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:

## üß† Model —Å —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

```dart
class FavoritesModel implements IFavoritesModel {
  final FavoritesDao _favoritesDao;
  
  FavoritesModel(this._favoritesDao);

  @override
  Stream<List<PlaceEntity>> get favoritesStream => 
    _favoritesDao.favoritesStream.map(
      (favorites) => favorites.map(_converter.convert).toList()
    );

  @override
  Future<void> addToFavorites(PlaceEntity place) async {
    final companion = FavoritePlacesTableCompanion(
      placeId: Value(place.id),
      name: Value(place.name),
      description: Value(place.description),
      type: Value(place.type),
      images: Value(place.images),
      lat: Value(place.coordinates.lat),
      lon: Value(place.coordinates.lon),
    );
    
    await _favoritesDao.addFavorite(companion);
  }

  @override
  Future<void> removeFromFavorites(int placeId) async {
    await _favoritesDao.removeFavorite(placeId);
  }

  @override
  Future<bool> isFavorite(int placeId) async {
    final favorites = await _favoritesDao.fetchFavorites();
    return favorites.any((fav) => fav.placeId == placeId);
  }
}
```

## üì± –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ UI

```dart
class FavoritesPage extends StatelessWidget {
  final IFavoritesModel favoritesModel;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞')),
      body: StreamBuilder<List<PlaceEntity>>(
        stream: favoritesModel.favoritesStream,
        builder: (context, snapshot) {
          return switch (snapshot) {
            // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            AsyncSnapshot(:final connectionState) when connectionState == ConnectionState.waiting => 
              const Center(child: CircularProgressIndicator()),
            
            // –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö  
            AsyncSnapshot(:final data) when data != null && data.isNotEmpty => 
              ListView.builder(
                itemCount: data.length,
                itemBuilder: (context, index) => PlaceCard(
                  place: data[index],
                  onFavoriteToggle: () => _toggleFavorite(data[index]),
                ),
              ),
            
            // –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö
            AsyncSnapshot(:final data) when data != null && data.isEmpty => 
              const EmptyFavoritesPlaceholder(),
            
            // –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
            AsyncSnapshot(:final error) when error != null => 
              ErrorPlaceholder(
                message: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç',
                onRetry: () => setState(() {}),
              ),
            
            _ => const SizedBox.shrink(),
          };
        },
      ),
    );
  }

  void _toggleFavorite(PlaceEntity place) async {
    final isFavorite = await favoritesModel.isFavorite(place.id);
    if (isFavorite) {
      await favoritesModel.removeFromFavorites(place.id);
    } else {
      await favoritesModel.addToFavorites(place);
    }
  }
}
```

### üé® –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º:

|| –°–æ—Å—Ç–æ—è–Ω–∏–µ | UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç | –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
|----------|-------------|-------------|---------------------|
| **Loading** | `CircularProgressIndicator` | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ |
| **Loaded** | `ListView` —Å –¥–∞–Ω–Ω—ã–º–∏ | ‚ù§Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö |
| **Empty** | `EmptyPlaceholder` | üîç –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ |
| **Error** | `ErrorPlaceholder` | üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É |

---

# üìã –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å –ø–æ—à–∞–≥–æ–≤–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

## üöÄ –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `pubspec.yaml` –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:

```yaml
dependencies:
  # –ü—Ä–æ—Å—Ç–æ–µ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
  shared_preferences: ^2.2.2
  
  # SQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ORM
  drift: ^2.14.1
  
  # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–µ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
  path_provider: ^2.1.2
  path: ^1.8.3
  
  # –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON
  json_annotation: ^4.8.1

dev_dependencies:
  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞
  build_runner: ^2.4.7
  drift_dev: ^2.14.1
  json_serializable: ^6.7.1
```

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
flutter pub get
dart run build_runner build # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DAO –∏ —Ç–∞–±–ª–∏—Ü
```

## üîß –®–∞–≥ 2: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DI —Å–∏—Å—Ç–µ–º–µ

–í —Ñ–∞–π–ª–µ DI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

```dart
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SharedPreferences
final sharedPreferences = await SharedPreferences.getInstance();

// –°–æ–∑–¥–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â –Ω–∞—Å—Ç—Ä–æ–µ–∫
final filterStorage = FilterStorage(sharedPreferences);
final themeModeStorage = ThemeModeStorage(sharedPreferences);

// –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
final database = AppDatabase();

// –°–æ–∑–¥–∞–Ω–∏–µ DAO
final favoritesDao = database.favoritesDao;
final historySearchDao = database.historySearchDao;

// –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
final favoritesModel = FavoritesModel(favoritesDao);
final searchHistoryModel = SearchHistoryModel(historySearchDao);
```

## ‚úÖ –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

|| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º |
|---------|---------------------|-------------|-------------|
| **üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** | –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ | –ò–∑–±—Ä–∞–Ω–Ω—ã–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **üîÑ –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** | UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö | StreamBuilder |
| **üö® –û—à–∏–±–∫–∏** | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ | –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ |

---

# üéØ –ó–∞–¥–∞–Ω–∏—è –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

## üü¢ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É "3" *(–±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å)*

**üéØ –¶–µ–ª—å:** –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–æ, —á—Ç–æ –±—ã–ª–æ –≤ —Ä–∞–º–∫–∞—Ö –º–µ—Ç–æ–¥–∏—á–∫–∏ - –∏–∑—É—á–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### üìã –ó–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. **–ò–∑—É—á–∏—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞**
   - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `lib/persistence/`
   - –ò–∑—É—á–∏—Ç–µ —Ä–∞–±–æ—Ç—É `AppDatabase` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ç–∞–±–ª–∏—Ü
   - –†–∞–∑–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É `SharedPreferences` –∏ `Drift` –ø–æ–¥—Ö–æ–¥–∞–º–∏

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –º–µ—Å—Ç**
   - –î–æ–±–∞–≤—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
   - –ó–∞–∫—Ä–æ–π—Ç–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å
   - –ò–∑—É—á–∏—Ç–µ –∫–æ–¥ `FavoritesDao` –∏ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π

3. **–ò–∑—É—á–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–µ–º—ã**
   - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ —Ç–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–≤–µ—Ç–ª—É—é/—Ç–µ–º–Ω—É—é)
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∞—Å—å
   - –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–æ–¥ `ThemeModeStorage` –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å `SharedPreferences`

4. **–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞**
   - –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ò–∑—É—á–∏—Ç–µ, –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –≤ `HistorySearchDao`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏

---

## üü° –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É "4" *(–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å)*

**üéØ –¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:**

### üìã –ó–∞–¥–∞—á–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. **–£–ª—É—á—à–∏—Ç–µ FilterStorage**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `FilterStorage` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ SharedPreferences
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –î–æ–±–∞–≤—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑ SharedPreferences
   - –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ —Å–±—Ä–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å UI —Å–ª–æ–µ–º**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É "–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

---

## üî¥ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ü–µ–Ω–∫—É "5" *(—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å)*

**üéØ –¶–µ–ª—å:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ Drift

**üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:**

### üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤**
   - –°–æ–∑–¥–∞–π—Ç–µ `FilterSettingsTable` –≤ Drift —Å –ø–æ–ª—è–º–∏ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞
   - –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—è –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: `id`, `name`, `createdAt`, `updatedAt`, `isDefault`
   - –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (—Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –¥–∏–∞–ø–∞–∑–æ–Ω—ã)
   - –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –¥–∞—Ç–µ –∏ –∏–º–µ–Ω–∏

2. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ FilterSettingsDao**
   - –°–æ–∑–¥–∞–π—Ç–µ DAO —Å –º–µ—Ç–æ–¥–∞–º–∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ –∏ —Å–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–µ—Å–µ—Ç–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–æ–∏—Å–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ –∏–º–µ–Ω–∏ –∏ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è

3. **–û–±–Ω–æ–≤–∏—Ç–µ FilterStorage –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Drift**
   - –ü–µ—Ä–µ–ø–∏—à–∏—Ç–µ `FilterStorage` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `FilterSettingsDao` –≤–º–µ—Å—Ç–æ SharedPreferences  
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º `IFilterStorage`
   - –î–æ–±–∞–≤—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ SharedPreferences —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
   - –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –ø–∞–º—è—Ç–∏

4. **–†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   - –£–≤–µ–ª–∏—á—å—Ç–µ `schemaVersion` –≤ `AppDatabase`
   - –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ SharedPreferences –≤ Drift
   - –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫
